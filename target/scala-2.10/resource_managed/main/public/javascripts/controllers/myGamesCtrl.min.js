app.controller("myGamesCtrl",["$scope","$location","$timeout","Games","$dialog",function($scope,$location,$timeout,Games,$dialog){var intervalID;var querygame;$scope.games=[];querygame=function(){return Games.query({},function(data){return $scope.games=data},function(error){return console.log("Error occurred while getting list of games")})};querygame();$scope.showDetails=function(idx){var games;games=$scope.games[idx];if(games.status==="online")window.location.pathname="/my/games/"+games.id;if(games.status===
"published"||games.status==="project")return window.location.pathname="/my/games/"+games.id+"/edit"};$scope["delete"]=function(idx){var btns;var games;var msg;var title;games=$scope.games[idx];if(games.status==="project"){title=games.name;msg="Are you sure you want to delete this game?";btns=[{result:"no",label:"No"},{result:"ok",label:"Yes, delete this game",cssClass:"btn-primary"}];return $dialog.messageBox(title,msg,btns).open().then(function(result){if(result==="ok")return Games["delete"]({gid:games.id},
function(data){return $scope.games.splice(idx,1)},function(error){return alert("Error occured when deleting the game.")})})}};$scope.cancel=function(idx){var btns;var games;var msg;var title;games=$scope.games[idx];if(games.status==="published"){title=games.name;msg="Are you sure you want to cancel this game?";btns=[{result:"no",label:"No"},{result:"ok",label:"Yes, cancel this game",cssClass:"btn-primary"}];return $dialog.messageBox(title,msg,btns).open().then(function(result){if(result==="ok")return Games.cancel({data:games.id},
function(data){return $scope.games[idx].status="project"},function(error){return alert("Error occured when canceling the game.")})})}};$scope.timeLeft=function(sdate,edate){var dateEnd;var dateStart;var days;var diff;var hours;var minutes;var now;var seconds;var zeros;zeros=function(x){return(x<10?"0":"")+x};dateStart=new Date(sdate);dateEnd=new Date(edate);now=new Date;diff=now>dateStart?dateEnd-now:dateStart-now;days=parseInt(diff/(1E3*60*60*24));hours=parseInt(diff%(1E3*60*60*24)/(1E3*60*60));
minutes=parseInt(diff%(1E3*60*60*24)%(1E3*60*60)/(1E3*60));seconds=parseInt(diff%(1E3*60*60*24)%(1E3*60*60)%(1E3*60)/1E3);return zeros(days)+"d:"+zeros(hours)+"h:"+zeros(minutes)+"min:"+zeros(seconds)+"sec"};$scope.mtimeLeft=[];return intervalID=window.setInterval(function(){var i;var _i;var _len;var _ref;_ref=$scope.games;for(_i=0,_len=_ref.length;_i<_len;_i++){i=_ref[_i];$scope.mtimeLeft[_i]=$scope.timeLeft(i.startTime,i.endTime)}return $scope.$apply()},1E3)}]);